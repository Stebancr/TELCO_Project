<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web ML - Predicción y Clustering</title>
    <!-- Incluir Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilo base para el color y la fuente */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* bg-slate-50 */
        }
        /* Estilos para el input/select */
        .input-field {
            @apply w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150;
        }
    </style>
</head>
<body>

    <div class="container mx-auto p-4 md:p-8">
        <h1 class="text-4xl font-extrabold text-center text-gray-800 mb-10">
            Demostrador de Modelos ML
        </h1>

        <!-- Mensaje de Error General -->
        {% if error_message %}
        <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mb-6 shadow-md" role="alert">
            <p class="font-bold">Error del Sistema</p>
            <p class="text-sm">{{ error_message }}</p>
        </div>
        {% endif %}

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

            <!-- Card 1: Predicción Churn (Logística & KNN) -->
            <div class="bg-white p-6 md:p-8 rounded-xl shadow-2xl border border-gray-100">
                <h2 class="text-2xl font-bold text-gray-700 mb-6 border-b pb-3">
                    1. Predicción Churn (Telco)
                    <span class="text-sm font-normal text-gray-500 block">Regresión Logística & KNN</span>
                </h2>

                <form method="post" class="space-y-4">
                    <input type="hidden" name="action" value="predict_churn">

                    <div>
                        <label for="senior_churn" class="block text-sm font-medium text-gray-700 mb-1">Adulto Mayor (0: No / 1: Sí)</label>
                        <input type="number" id="senior_churn" step="1" min="0" max="1" name="SeniorCitizen_churn" required class="input-field" placeholder="0 o 1">
                    </div>
                    <div>
                        <label for="tenure_churn" class="block text-sm font-medium text-gray-700 mb-1">Meses de permanencia</label>
                        <input type="number" id="tenure_churn" step="1" min="0" name="tenure_churn" required class="input-field" placeholder="Ej: 24">
                    </div>
                    <div>
                        <label for="monthly_churn" class="block text-sm font-medium text-gray-700 mb-1">Cargo Mensual</label>
                        <input type="number" id="monthly_churn" step="0.01" min="0" name="MonthlyCharges_churn" required class="input-field" placeholder="Ej: 75.90">
                    </div>
                    <div>
                        <label for="total_churn" class="block text-sm font-medium text-gray-700 mb-1">Cargos Totales</label>
                        <input type="number" id="total_churn" step="0.01" min="0" name="TotalCharges_churn" required class="input-field" placeholder="Ej: 1800.50">
                    </div>

                    <button type="submit" class="w-full bg-blue-600 text-white p-3 rounded-lg font-semibold hover:bg-blue-700 transition duration-200 shadow-md hover:shadow-lg">
                        Predecir Churn
                    </button>
                </form>

                <!-- Resultados Telco -->
                {% if telco_result %}
                <div class="mt-8 pt-6 border-t border-gray-200 bg-blue-50 p-4 rounded-lg shadow-inner">
                    <h3 class="text-xl font-bold text-blue-800 mb-3">Resultados de Predicción:</h3>
                    <p class="text-gray-700 mb-2">
                        <span class="font-semibold text-blue-600">Probabilidad Churn (Logística):</span> 
                        <span class="font-mono text-lg ml-2">{{ telco_result.log_prob * 100 }}%</span>
                    </p>
                    <div class="space-y-1">
                        <p class="text-gray-700">
                            <span class="font-semibold text-gray-600">Clasificación Logística:</span> 
                            <span class="font-bold ml-2 {% if telco_result.log_result == 'Sí' %}text-red-500{% else %}text-green-600{% endif %}">{{ telco_result.log_result }}</span>
                        </p>
                        <p class="text-gray-700">
                            <span class="font-semibold text-gray-600">Clasificación KNN:</span> 
                            <span class="font-bold ml-2 {% if telco_result.knn_result == 'Sí' %}text-red-500{% else %}text-green-600{% endif %}">{{ telco_result.knn_result }}</span>
                        </p>
                    </div>
                </div>
                {% endif %}
            </div>

            <!-- Card 2: Clustering K-Means -->
            <div class="bg-white p-6 md:p-8 rounded-xl shadow-2xl border border-gray-100">
                <h2 class="text-2xl font-bold text-gray-700 mb-6 border-b pb-3">
                    2. Clustering K-Means
                    <span class="text-sm font-normal text-gray-500 block">Asignación de Cluster (3 Features)</span>
                </h2>

                <form method="post" class="space-y-4">
                    <input type="hidden" name="action" value="predict_kmeans">
                    
                    <div>
                        <label for="senior_kmeans" class="block text-sm font-medium text-gray-700 mb-1">Adulto Mayor (0: No / 1: Sí)</label>
                        <input type="number" id="senior_kmeans" step="1" min="0" max="1" name="SeniorCitizen_kmeans" required class="input-field" placeholder="0 o 1">
                    </div>
                    <div>
                        <label for="tenure_kmeans" class="block text-sm font-medium text-gray-700 mb-1">Meses de permanencia</label>
                        <input type="number" id="tenure_kmeans" step="1" min="0" name="tenure_kmeans" required class="input-field" placeholder="Ej: 24">
                    </div>
                    <div>
                        <label for="monthly_kmeans" class="block text-sm font-medium text-gray-700 mb-1">Cargo Mensual</label>
                        <input type="number" id="monthly_kmeans" step="0.01" min="0" name="MonthlyCharges_kmeans" required class="input-field" placeholder="Ej: 75.90">
                    </div>
                    
                    <button type="submit" class="w-full bg-green-600 text-white p-3 rounded-lg font-semibold hover:bg-green-700 transition duration-200 shadow-md hover:shadow-lg">
                        Clasificar Cluster
                    </button>
                </form>

                <!-- Resultados K-Means -->
                {% if kmeans_result %}
                <div class="mt-8 pt-6 border-t border-gray-200 bg-green-50 p-4 rounded-lg shadow-inner">
                    <h3 class="text-xl font-bold text-green-800 mb-3">Resultado de Clustering:</h3>
                    <p class="text-gray-700 mb-2">
                        <span class="font-semibold text-green-600">Cluster Asignado:</span> 
                        <span class="font-mono text-lg ml-2">{{ kmeans_result.cluster }}</span>
                    </p>
                    <p class="text-gray-700">
                        <span class="font-semibold text-gray-600">Perfil del Cluster:</span> 
                        <span class="ml-2 italic">{{ kmeans_result.desc }}</span>
                    </p>
                </div>
                {% endif %}
            </div>

        </div>
    </div>

</body>
</html>